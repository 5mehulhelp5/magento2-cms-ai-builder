{
    "type": "json_schema",
    "name": "json_patch_response",
    "schema": {
        "type": "object",
        "$defs": {
            "DaffContentSchema": {
                "anyOf": [
                    {"$ref": "#/$defs/DaffTextSchema"},
                    {"$ref": "#/$defs/DaffContentElementSchema"}
                ]
            },
            "DaffTextSchema": {
                "type": "object",
                "properties": {
                    "type": {"type": "string", "const": "textSchema"},
                    "text": {"type": "string"}
                },
                "required": ["type", "text"],
                "additionalProperties": false
            },
            "DaffContentElementSchema": {
                "type": "object",
                "properties": {
                    "type": {"type": "string", "const": "elementSchema"},
                    "element": {"type": "string"},
                    "attributes": {
                        "type": "object",
                        "additionalProperties": {"type": "string"}
                    },
                    "children": {
                        "type": "array",
                        "items": {"$ref": "#/$defs/DaffContentSchema"}
                    },
                    "styles": {"$ref": "#/$defs/StylesObject"}
                },
                "required": ["type", "element", "children", "styles"],
                "additionalProperties": false
            },
            "CssStyleObject": {
                "type": "object",
                "description": "CSS styles as key-value pairs (e.g. {\"margin\": \"10px\", \"display\": \"flex\"}).",
                "properties": {},
                "required": [],
                "additionalProperties": {
                    "anyOf": [
                        {"type": "string"},
                        {"type": "number"}
                    ]
                }
            },
            "BreakpointsObject": {
                "type": "object",
                "description": "Responsive styles keyed by media query condition.",
                "properties": {},
                "required": [],
                "additionalProperties": {"$ref": "#/$defs/CssStyleObject"}
            },
            "StylesObject": {
                "type": "object",
                "description": "Element styles with base and responsive breakpoints.",
                "properties": {
                    "base": {"$ref": "#/$defs/CssStyleObject"},
                    "breakpoints": {"$ref": "#/$defs/BreakpointsObject"}
                },
                "required": ["base", "breakpoints"],
                "additionalProperties": false
            },
            "JsonValue": {
                "anyOf": [
                    {"type": "string"},
                    {"type": "number"},
                    {"type": "boolean"},
                    {"type": "null"},
                    {"$ref": "#/$defs/DaffContentSchema"},
                    {"$ref": "#/$defs/StylesObject"}
                ]
            }
        },
        "properties": {
            "reply": {
                "type": "string",
                "description": "Brief explanation of changes made"
            },
            "patch": {
                "type": "array",
                "description": "Array of JSON Patch operations (RFC 6902)",
                "items": {
                    "type": "object",
                    "anyOf": [
                        {
                            "additionalProperties": false,
                            "required": ["op", "value", "path"],
                            "properties": {
                                "op": {"type": "string", "const": "add"},
                                "value": {"$ref": "#/$defs/JsonValue"},
                                "path": {"type": "string"}
                            }
                        },
                        {
                            "additionalProperties": false,
                            "required": ["op", "value", "path"],
                            "properties": {
                                "op": {"type": "string", "const": "replace"},
                                "value": {"$ref": "#/$defs/JsonValue"},
                                "path": {"type": "string"}
                            }
                        },
                        {
                            "additionalProperties": false,
                            "required": ["op", "path"],
                            "properties": {
                                "op": {"type": "string", "const": "remove"},
                                "path": {"type": "string"}
                            }
                        },
                        {
                            "additionalProperties": false,
                            "required": ["op", "from", "path"],
                            "properties": {
                                "op": {"type": "string", "const": "copy"},
                                "from": {"type": "string", "minLength": 1},
                                "path": {"type": "string"}
                            }
                        },
                        {
                            "additionalProperties": false,
                            "required": ["op", "from", "path"],
                            "properties": {
                                "op": {"type": "string", "const": "move"},
                                "from": {"type": "string", "minLength": 1},
                                "path": {"type": "string"}
                            }
                        },
                        {
                            "additionalProperties": false,
                            "required": ["op", "value", "path"],
                            "properties": {
                                "op": {"type": "string", "const": "test"},
                                "value": {"$ref": "#/$defs/JsonValue"},
                                "path": {"type": "string", "minLength": 1}
                            }
                        }
                    ]
                }
            }
        },
        "required": ["reply", "patch"],
        "additionalProperties": false
    }
}